<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Payment - PayMe 2D Gateway</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .payment-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }

        .payment-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .order-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #666;
        }

        .summary-row.total {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            padding-top: 15px;
            border-top: 2px solid #dee2e6;
            margin-top: 15px;
        }

        .payment-methods {
            margin: 30px 0;
        }

        .payment-method-btn {
            width: 100%;
            padding: 20px;
            margin-bottom: 15px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .payment-method-btn:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .payment-method-btn.selected {
            border-color: #667eea;
            background: #e3f2fd;
        }

        .payment-method-icon {
            font-size: 32px;
        }

        .payment-method-icon img {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        .payment-method-info h4 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .payment-method-info p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .btn-pay {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-pay:hover {
            transform: translateY(-2px);
        }

        .btn-pay:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .security-note {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-top: 20px;
        }

        .crypto-payment-details {
            display: none;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .crypto-payment-details.show {
            display: block;
        }

        .wallet-address {
            background: white;
            padding: 15px;
            border-radius: 8px;
            word-break: break-all;
            font-family: monospace;
            margin: 10px 0;
            border: 2px solid #667eea;
        }

        .qr-code-display {
            text-align: center;
            margin: 20px 0;
        }

        .qr-code-display img {
            max-width: 200px;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 10px;
            background: white;
        }
    </style>
</head>
<body>
    <div class="payment-container">
        <div class="payment-card">
            <h1 style="text-align: center; margin-bottom: 30px;">üí≥ Complete Your Payment</h1>

            <!-- Order Summary -->
            <div class="order-summary">
                <h3 style="margin: 0 0 15px 0;">Order Summary</h3>
                <div class="summary-row">
                    <span>Plan:</span>
                    <span id="planName">Monthly Plan</span>
                </div>
                <div class="summary-row">
                    <span>Duration:</span>
                    <span id="planDuration">1 Month</span>
                </div>
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span id="subtotal">$60.00</span>
                </div>
                <div class="summary-row total">
                    <span>Total:</span>
                    <span id="totalAmount">$60.00</span>
                </div>
            </div>

            <!-- Payment Methods -->
            <div class="payment-methods">
                <h3 style="margin-bottom: 20px;">Select Payment Method</h3>

                <button class="payment-method-btn" onclick="selectPaymentMethod('card')">
                    <div class="payment-method-icon">
                        <div style="display: flex; gap: 5px;">
                            <img src="images/payment-methods/visa.png" alt="Visa">
                            <img src="images/payment-methods/mastercard.png" alt="Mastercard">
                        </div>
                    </div>
                    <div class="payment-method-info">
                        <h4>Credit/Debit Card</h4>
                        <p>Visa, Mastercard, Amex accepted</p>
                    </div>
                </button>

                <button class="payment-method-btn" onclick="selectPaymentMethod('upi')">
                    <div class="payment-method-icon">
                        <img src="images/payment-methods/upi.png" alt="UPI">
                    </div>
                    <div class="payment-method-info">
                        <h4>UPI</h4>
                        <p>Google Pay, PhonePe, Paytm, BHIM</p>
                    </div>
                </button>

                <button class="payment-method-btn" onclick="selectPaymentMethod('netbanking')">
                    <div class="payment-method-icon">üè¶</div>
                    <div class="payment-method-info">
                        <h4>Net Banking</h4>
                        <p>All major Indian banks</p>
                    </div>
                </button>

                <button class="payment-method-btn" onclick="selectPaymentMethod('crypto')">
                    <div class="payment-method-icon">
                        <div style="display: flex; gap: 5px;">
                            <img src="images/crypto/bitcoin.png" alt="Bitcoin" style="width: 30px; height: 30px;">
                            <img src="images/crypto/ethereum.png" alt="Ethereum" style="width: 30px; height: 30px;">
                            <img src="images/crypto/tether.png" alt="USDT" style="width: 30px; height: 30px;">
                        </div>
                    </div>
                    <div class="payment-method-info">
                        <h4>Cryptocurrency</h4>
                        <p>Bitcoin, Ethereum, USDT, BNB</p>
                    </div>
                </button>
            </div>

            <!-- Crypto Payment Details (Hidden by default) -->
            <div class="crypto-payment-details" id="cryptoPaymentDetails">
                <h4 style="margin-top: 0;">Select Cryptocurrency</h4>
                <select id="cryptoSelect" onchange="updateCryptoDetails()" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #e9ecef; margin-bottom: 20px;">
                    <option value="">Choose cryptocurrency</option>
                    <option value="btc">Bitcoin (BTC)</option>
                    <option value="eth">Ethereum (ETH)</option>
                    <option value="usdt">Tether (USDT)</option>
                    <option value="bnb">Binance Coin (BNB)</option>
                </select>

                <div id="cryptoDetailsDisplay" style="display: none;">
                    <p style="color: #666; margin-bottom: 15px;">Send exactly <strong id="cryptoAmount">0.00</strong> <span id="cryptoSymbol">BTC</span> to:</p>
                    
                    <div class="wallet-address" id="walletAddress">
                        Wallet address will appear here
                    </div>

                    <button onclick="copyWalletAddress()" style="width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; margin-bottom: 15px;">
                        üìã Copy Wallet Address
                    </button>

                    <div class="qr-code-display">
                        <p style="color: #666; margin-bottom: 10px;">Or scan QR code:</p>
                        <div id="qrCodeContainer" style="display: inline-block; padding: 15px; background: white; border-radius: 8px;">
                            <div style="width: 200px; height: 200px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border-radius: 8px;">
                                <span style="color: #999;">QR Code</span>
                            </div>
                        </div>
                    </div>

                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <p style="margin: 0; color: #856404; font-size: 14px;">
                            ‚ö†Ô∏è <strong>Important:</strong> Send only <span id="cryptoSymbol2">BTC</span> to this address. Sending other cryptocurrencies may result in permanent loss.
                        </p>
                    </div>

                    <p style="text-align: center; color: #666; margin-top: 20px;">
                        After sending payment, your subscription will be activated within 10-30 minutes after blockchain confirmation.
                    </p>
                </div>
            </div>

            <!-- Pay Button -->
            <button class="btn-pay" id="payButton" onclick="processPayment()" disabled>
                Select Payment Method
            </button>

            <div class="security-note">
                üîí Your payment is secure and encrypted
            </div>
        </div>
    </div>

    <script>
        let selectedPaymentMethod = null;
        let planDetails = {};

        // Crypto wallet addresses (admin's wallets for receiving subscription payments)
        const adminCryptoWallets = {
            btc: '1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa',
            eth: '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb',
            usdt: '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb',
            bnb: '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb'
        };

        // Crypto prices (example rates - should be fetched from API in production)
        const cryptoPrices = {
            btc: 43000,
            eth: 2300,
            usdt: 1,
            bnb: 310
        };

        window.addEventListener('DOMContentLoaded', function() {
            loadPlanDetails();
        });

        function loadPlanDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const plan = urlParams.get('plan');
            const amount = urlParams.get('amount');

            const planNames = {
                'monthly': 'Monthly Plan',
                'quarterly': 'Quarterly Plan',
                'yearly': 'Yearly Plan'
            };

            const planDurations = {
                'monthly': '1 Month',
                'quarterly': '3 Months',
                'yearly': '12 Months'
            };

            planDetails = {
                plan: plan,
                amount: parseFloat(amount),
                name: planNames[plan],
                duration: planDurations[plan]
            };

            document.getElementById('planName').textContent = planDetails.name;
            document.getElementById('planDuration').textContent = planDetails.duration;
            document.getElementById('subtotal').textContent = '$' + planDetails.amount.toFixed(2);
            document.getElementById('totalAmount').textContent = '$' + planDetails.amount.toFixed(2);
        }

        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;

            // Remove selected class from all buttons
            document.querySelectorAll('.payment-method-btn').forEach(btn => {
                btn.classList.remove('selected');
            });

            // Add selected class to clicked button
            event.target.closest('.payment-method-btn').classList.add('selected');

            // Show/hide crypto details
            if (method === 'crypto') {
                document.getElementById('cryptoPaymentDetails').classList.add('show');
                document.getElementById('payButton').textContent = 'Waiting for Crypto Selection...';
                document.getElementById('payButton').disabled = true;
            } else {
                document.getElementById('cryptoPaymentDetails').classList.remove('show');
                document.getElementById('payButton').textContent = 'Pay $' + planDetails.amount.toFixed(2);
                document.getElementById('payButton').disabled = false;
            }
        }

        function updateCryptoDetails() {
            const crypto = document.getElementById('cryptoSelect').value;
            
            if (!crypto) {
                document.getElementById('cryptoDetailsDisplay').style.display = 'none';
                document.getElementById('payButton').disabled = true;
                return;
            }

            const cryptoAmount = (planDetails.amount / cryptoPrices[crypto]).toFixed(8);
            const cryptoSymbols = {
                btc: 'BTC',
                eth: 'ETH',
                usdt: 'USDT',
                bnb: 'BNB'
            };

            document.getElementById('cryptoAmount').textContent = cryptoAmount;
            document.getElementById('cryptoSymbol').textContent = cryptoSymbols[crypto];
            document.getElementById('cryptoSymbol2').textContent = cryptoSymbols[crypto];
            document.getElementById('walletAddress').textContent = adminCryptoWallets[crypto];
            document.getElementById('cryptoDetailsDisplay').style.display = 'block';

            document.getElementById('payButton').textContent = 'I Have Sent the Payment';
            document.getElementById('payButton').disabled = false;
        }

        function copyWalletAddress() {
            const address = document.getElementById('walletAddress').textContent;
            navigator.clipboard.writeText(address).then(() => {
                alert('‚úÖ Wallet address copied to clipboard!');
            });
        }

        function processPayment() {
            if (!selectedPaymentMethod) {
                alert('‚ùå Please select a payment method');
                return;
            }

            if (selectedPaymentMethod === 'crypto') {
                const crypto = document.getElementById('cryptoSelect').value;
                if (!crypto) {
                    alert('‚ùå Please select a cryptocurrency');
                    return;
                }

                if (confirm('Have you sent the payment?\n\nYour subscription will be activated after blockchain confirmation (10-30 minutes).')) {
                    // Save pending subscription
                    const subscription = {
                        status: 'pending',
                        plan: planDetails.plan,
                        amount: planDetails.amount,
                        paymentMethod: 'crypto_' + crypto,
                        timestamp: new Date().toISOString()
                    };
                    localStorage.setItem('subscription', JSON.stringify(subscription));

                    alert('‚úÖ Payment confirmation received!\n\nWe are waiting for blockchain confirmation. You will receive an email once your subscription is activated.\n\nTransaction ID: TXN' + Date.now());
                    window.location.href = 'subscription.html';
                }
            } else {
                // For other payment methods, simulate payment gateway
                if (confirm('Proceed to payment gateway?\n\nAmount: $' + planDetails.amount.toFixed(2) + '\nMethod: ' + selectedPaymentMethod.toUpperCase())) {
                    // Simulate successful payment
                    const subscription = {
                        status: 'active',
                        plan: planDetails.plan,
                        amount: planDetails.amount,
                        paymentMethod: selectedPaymentMethod,
                        startDate: new Date().toISOString(),
                        endDate: calculateEndDate(planDetails.plan),
                        transactionId: 'TXN' + Date.now()
                    };
                    localStorage.setItem('subscription', JSON.stringify(subscription));

                    alert('‚úÖ Payment Successful!\n\nYour subscription is now active.\nTransaction ID: ' + subscription.transactionId);
                    window.location.href = 'subscription.html';
                }
            }
        }

        function calculateEndDate(plan) {
            const now = new Date();
            if (plan === 'monthly') {
                now.setMonth(now.getMonth() + 1);
            } else if (plan === 'quarterly') {
                now.setMonth(now.getMonth() + 3);
            } else if (plan === 'yearly') {
                now.setFullYear(now.getFullYear() + 1);
            }
            return now.toISOString();
        }
    </script>
</body>
</html>
