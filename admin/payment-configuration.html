<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Configuration - Admin Panel</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
        }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar h1 {
            font-size: 1.5rem;
        }

        .navbar a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .page-header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .page-header h2 {
            font-size: 2rem;
            color: #333;
            margin-bottom: 10px;
        }

        .page-header p {
            color: #666;
            font-size: 1.1rem;
        }

        .config-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .config-section h3 {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn {
            padding: 12px 30px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .help-text {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="responsive-admin.css?v=5.0">
</head>
<body>
    <nav class="navbar">
        <h1>üí≥ PayMe 2D Gateway - Admin Panel</h1>
        <div>
            <a href="dashboard.html">Dashboard</a>
            <a href="plan-management.html">Plans</a>
            <a href="reseller-management.html">Resellers</a>
            <a href="activation-codes.html">Codes</a>
            <a href="payment-configuration.html">Payment Config</a>
            <a href="login.html">Logout</a>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h2>‚öôÔ∏è Payment Configuration</h2>
            <p>Configure your payment details where customer payments will be received</p>
        </div>

        <div class="alert alert-info">
            <strong>‚ÑπÔ∏è Important:</strong> When customers purchase activation codes, payments will be sent directly to the accounts configured below. Make sure all details are correct.
        </div>

        <!-- Bank Account Configuration -->
        <div class="config-section">
            <h3>üè¶ Bank Account Details</h3>
            <p class="help-text">Customers can transfer money directly to this bank account</p>
            
            <div class="form-row" style="margin-top: 20px;">
                <div class="form-group">
                    <label for="bank-name">Bank Name *</label>
                    <select id="bank-name">
                        <option value="">Select Bank</option>
                        <option value="HDFC Bank">HDFC Bank</option>
                        <option value="ICICI Bank">ICICI Bank</option>
                        <option value="State Bank of India">State Bank of India</option>
                        <option value="Axis Bank">Axis Bank</option>
                        <option value="Kotak Mahindra Bank">Kotak Mahindra Bank</option>
                        <option value="Punjab National Bank">Punjab National Bank</option>
                        <option value="Bank of Baroda">Bank of Baroda</option>
                        <option value="Canara Bank">Canara Bank</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="account-type">Account Type *</label>
                    <select id="account-type">
                        <option value="Savings">Savings</option>
                        <option value="Current">Current</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="account-holder">Account Holder Name *</label>
                <input type="text" id="account-holder" placeholder="Enter account holder name as per bank">
                <span class="help-text">Enter name exactly as it appears in your bank account</span>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="account-number">Account Number *</label>
                    <input type="text" id="account-number" placeholder="Enter account number">
                </div>
                <div class="form-group">
                    <label for="confirm-account">Confirm Account Number *</label>
                    <input type="text" id="confirm-account" placeholder="Re-enter account number">
                </div>
            </div>

            <div class="form-group">
                <label for="ifsc-code">IFSC Code *</label>
                <input type="text" id="ifsc-code" placeholder="Enter IFSC code">
                <span class="help-text">Example: HDFC0001234</span>
            </div>

            <button class="btn btn-primary" onclick="saveBankDetails()">üíæ Save Bank Details</button>
        </div>

        <!-- UPI Configuration -->
        <div class="config-section">
            <h3>üì± UPI Payment Details</h3>
            <p class="help-text">Customers can pay instantly via UPI (Google Pay, PhonePe, Paytm, etc.)</p>

            <div class="form-row" style="margin-top: 20px;">
                <div class="form-group">
                    <label for="upi-id">UPI ID *</label>
                    <input type="text" id="upi-id" placeholder="yourname@okhdfc">
                    <span class="help-text">Example: yourname@okhdfc, yourname@ybl, yourname@paytm</span>
                </div>
                <div class="form-group">
                    <label for="upi-name">UPI Name *</label>
                    <input type="text" id="upi-name" placeholder="Your Name">
                    <span class="help-text">Name registered with UPI</span>
                </div>
            </div>

            <div class="form-group">
                <label for="upi-provider">UPI Provider *</label>
                <select id="upi-provider">
                    <option value="">Select Provider</option>
                    <option value="Google Pay">Google Pay</option>
                    <option value="PhonePe">PhonePe</option>
                    <option value="Paytm">Paytm</option>
                    <option value="BHIM">BHIM</option>
                    <option value="Amazon Pay">Amazon Pay</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="saveUPIDetails()">üíæ Save UPI Details</button>
        </div>

        <!-- Cryptocurrency Configuration -->
        <div class="config-section">
            <h3>üíé Cryptocurrency Wallet Addresses</h3>
            <p class="help-text">Accept payments in cryptocurrency (Optional)</p>

            <div class="form-group" style="margin-top: 20px;">
                <label for="btc-wallet">Bitcoin (BTC) Wallet Address</label>
                <input type="text" id="btc-wallet" placeholder="Enter Bitcoin wallet address">
                <span class="help-text">Example: 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa</span>
            </div>

            <div class="form-group">
                <label for="eth-wallet">Ethereum (ETH) Wallet Address</label>
                <input type="text" id="eth-wallet" placeholder="Enter Ethereum wallet address">
                <span class="help-text">Example: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb</span>
            </div>

            <div class="form-group">
                <label for="usdt-wallet">Tether (USDT) Wallet Address</label>
                <input type="text" id="usdt-wallet" placeholder="Enter USDT wallet address">
                <span class="help-text">Specify network: ERC-20, TRC-20, or BEP-20</span>
            </div>

            <div class="form-group">
                <label for="bnb-wallet">Binance Coin (BNB) Wallet Address</label>
                <input type="text" id="bnb-wallet" placeholder="Enter BNB wallet address">
                <span class="help-text">BSC (Binance Smart Chain) address</span>
            </div>

            <button class="btn btn-primary" onclick="saveCryptoDetails()">üíæ Save Crypto Wallets</button>
        </div>

        <!-- Email Configuration -->
        <div class="config-section">
            <h3>üìß Email Configuration</h3>
            <p class="help-text">Configure email settings for sending activation codes to customers</p>

            <div class="form-group" style="margin-top: 20px;">
                <label for="smtp-host">SMTP Host *</label>
                <input type="text" id="smtp-host" value="smtp.gmail.com" placeholder="smtp.gmail.com">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="smtp-port">SMTP Port *</label>
                    <input type="number" id="smtp-port" value="587" placeholder="587">
                </div>
                <div class="form-group">
                    <label for="smtp-username">SMTP Username (Email) *</label>
                    <input type="email" id="smtp-username" placeholder="your-email@gmail.com">
                </div>
            </div>

            <div class="form-group">
                <label for="smtp-password">SMTP Password / App Password *</label>
                <input type="password" id="smtp-password" placeholder="Enter app password">
                <span class="help-text">For Gmail, use App Password (not your regular password)</span>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="from-email">From Email *</label>
                    <input type="email" id="from-email" value="noreply@payme-gateway.com" placeholder="noreply@payme-gateway.com">
                </div>
                <div class="form-group">
                    <label for="from-name">From Name *</label>
                    <input type="text" id="from-name" value="PayMe 2D Gateway" placeholder="PayMe 2D Gateway">
                </div>
            </div>

            <div class="form-group">
                <label for="admin-notification-email">Admin Notification Email *</label>
                <input type="email" id="admin-notification-email" placeholder="admin@payme-gateway.com">
                <span class="help-text">You'll receive notifications when customers purchase codes</span>
            </div>

            <button class="btn btn-primary" onclick="saveEmailConfig()">üíæ Save Email Configuration</button>
        </div>

        <!-- Test Configuration -->
        <div class="config-section">
            <h3>üß™ Test Configuration</h3>
            <p class="help-text">Send test emails to verify your configuration</p>

            <div class="form-group" style="margin-top: 20px;">
                <label for="test-email">Test Email Address</label>
                <input type="email" id="test-email" placeholder="Enter email to receive test">
            </div>

            <button class="btn btn-success" onclick="sendTestEmail()">üìß Send Test Email</button>
        </div>

        <div id="success-message" class="alert alert-success" style="display: none;">
            <strong>‚úÖ Success!</strong> Configuration saved successfully.
        </div>
    </div>

    <script>
        // Load existing configuration
        async function loadConfiguration() {
            try {
                const response = await fetch('../api/admin/get-payment-config.php');
                const data = await response.json();
                
                if (data.success) {
                    // Bank details
                    document.getElementById('bank-name').value = data.bank_name || '';
                    document.getElementById('account-type').value = data.account_type || 'Savings';
                    document.getElementById('account-holder').value = data.account_holder || '';
                    document.getElementById('account-number').value = data.account_number || '';
                    document.getElementById('ifsc-code').value = data.ifsc_code || '';
                    
                    // UPI details
                    document.getElementById('upi-id').value = data.upi_id || '';
                    document.getElementById('upi-name').value = data.upi_name || '';
                    document.getElementById('upi-provider').value = data.upi_provider || '';
                    
                    // Crypto wallets
                    document.getElementById('btc-wallet').value = data.btc_wallet || '';
                    document.getElementById('eth-wallet').value = data.eth_wallet || '';
                    document.getElementById('usdt-wallet').value = data.usdt_wallet || '';
                    document.getElementById('bnb-wallet').value = data.bnb_wallet || '';
                    
                    // Email config
                    document.getElementById('smtp-host').value = data.smtp_host || 'smtp.gmail.com';
                    document.getElementById('smtp-port').value = data.smtp_port || '587';
                    document.getElementById('smtp-username').value = data.smtp_username || '';
                    document.getElementById('from-email').value = data.from_email || 'noreply@payme-gateway.com';
                    document.getElementById('from-name').value = data.from_name || 'PayMe 2D Gateway';
                    document.getElementById('admin-notification-email').value = data.admin_notification_email || '';
                }
            } catch (error) {
                console.error('Error loading configuration:', error);
            }
        }

        async function saveBankDetails() {
            const accountNumber = document.getElementById('account-number').value;
            const confirmAccount = document.getElementById('confirm-account').value;
            
            if (accountNumber !== confirmAccount) {
                alert('‚ùå Account numbers do not match!');
                return;
            }
            
            const data = {
                bank_name: document.getElementById('bank-name').value,
                account_type: document.getElementById('account-type').value,
                account_holder: document.getElementById('account-holder').value,
                account_number: accountNumber,
                ifsc_code: document.getElementById('ifsc-code').value
            };
            
            await saveConfig('bank', data);
        }

        async function saveUPIDetails() {
            const data = {
                upi_id: document.getElementById('upi-id').value,
                upi_name: document.getElementById('upi-name').value,
                upi_provider: document.getElementById('upi-provider').value
            };
            
            await saveConfig('upi', data);
        }

        async function saveCryptoDetails() {
            const data = {
                btc_wallet: document.getElementById('btc-wallet').value,
                eth_wallet: document.getElementById('eth-wallet').value,
                usdt_wallet: document.getElementById('usdt-wallet').value,
                bnb_wallet: document.getElementById('bnb-wallet').value
            };
            
            await saveConfig('crypto', data);
        }

        async function saveEmailConfig() {
            const data = {
                smtp_host: document.getElementById('smtp-host').value,
                smtp_port: document.getElementById('smtp-port').value,
                smtp_username: document.getElementById('smtp-username').value,
                smtp_password: document.getElementById('smtp-password').value,
                from_email: document.getElementById('from-email').value,
                from_name: document.getElementById('from-name').value,
                admin_notification_email: document.getElementById('admin-notification-email').value
            };
            
            await saveConfig('email', data);
        }

        async function saveConfig(type, data) {
            try {
                const response = await fetch('../api/admin/save-payment-config.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: type,
                        data: data
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess();
                } else {
                    alert('‚ùå Error: ' + result.message);
                }
            } catch (error) {
                console.error('Error saving configuration:', error);
                alert('‚ùå Error saving configuration');
            }
        }

        async function sendTestEmail() {
            const testEmail = document.getElementById('test-email').value;
            
            if (!testEmail) {
                alert('Please enter a test email address');
                return;
            }
            
            try {
                const response = await fetch('../api/admin/send-test-email.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: testEmail
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ Test email sent successfully! Check your inbox.');
                } else {
                    alert('‚ùå Error sending test email: ' + result.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå Error sending test email');
            }
        }

        function showSuccess() {
            const successMsg = document.getElementById('success-message');
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
        }

        // Load configuration on page load
        loadConfiguration();
    </script>
    <script src="responsive-menu.js"></script>
    <script src="load-navbar.js"></script>
    <script src="../js/admin-auth-check.js"></script>
</body>
</html>
